<!DOCTYPE html>

<html>

<head>
	<title>Image Processing</title>
	<script>

	var ctx;

	function image_process(){

		let imageData = ctx.getImageData(0, 0, 400, 400);
		
		for (let i=0; i<imageData.height; i++) {
		  for (let j=0; j<imageData.width; j++) {
			 var index=(i*4)*imageData.width+(j*4);
			 var red=imageData.data[index];
			 var green=imageData.data[index+1];
			 var blue=imageData.data[index+2];
			 var alpha=imageData.data[index+3];
			 var average=(red+green+blue)/3;
			 imageData.data[index]=average;
			 imageData.data[index+1]=average;
			 imageData.data[index+2]=average;
			 imageData.data[index+3]=alpha;
		   }
		 }
		 
		 ctx.putImageData(imageData, 400, 0);
	}
	
	function draw(){
		ctx = document.getElementById("my_canvas").getContext("2d");
		var image = document.getElementById("lenna");
		//image.crossOrigin = "Anonymous";
		//ctx.fillStyle = "#ff0000";		
		ctx.drawImage(image, 0, 0, 100, 100);
		//ctx.fillRect(0, 0, 400, 400);
		
		setTimeout(() => image_process(), 1000);
		
	}
		
	</script>
</head>

<body onload="draw()">

	<canvas id="my_canvas" width="800" height="800" style="border:1px solid black;"></canvas>
	<img id="lenna" src="asset/lenna.png" style="display:none;"/>
	
</body>

</html>