<!DOCTYPE html>
<html>
	<head>
		<title>Sun & Moon</title>
		<script>
		
			//star field
			var starField = {
				stars: [],
				cx: 0,
				cy: 0,
				init: function(cx, cy){
					this.cx = cx;
					this.cy = cy;
					
					for(let i=0; i<500; i++) {						
						var star = {
							x: Math.floor(Math.random()*(cx+1)),
							y: Math.floor(Math.random()*(cy+1)),
							r: Math.random()*2,
							c: (Math.random()/2) + 0.5
						};						
						this.stars[i] = star;						
					}
					
				},
				draw: function(ctx){
					ctx.save();
					ctx.fillStyle="#000000";
					ctx.fillRect(0, 0, this.cx, this.cy);
					
					ctx.fillStyle = "#ffffff";
					for(let i=0; i<500; i++) {
						var star = this.stars[i];
						ctx.globalAlpha = star.c;
						ctx.beginPath();
						ctx.arc(star.x, star.y, star.r, 0, 2*Math.PI, true);
						ctx.fill();
					}
					
					ctx.restore();					
				}
			};
			
			//the sun
			var sun = {
				x: 0,
				y: 0,
				init: function(x, y){
					this.x = x;
					this.y = y;
				},
				
				draw: function(ctx){
					ctx.save();
					ctx.fillStyle="#ffcc33";

					ctx.beginPath();
					ctx.arc(this.x, this.y, 20, 0, 2*Math.PI, true);
					ctx.fill();
					
					var r = 20;
					ctx.globalAlpha = 0.05;
					for(let i=0; i<10; i++){
						ctx.beginPath();
						ctx.arc(this.x, this.y, r, 0, 2*Math.PI, true);
						ctx.fill();
						r = r + 2;
					}
					
					ctx.restore();
				}
			};
			
			//the earth
			var earth = {
				d: 0, //distance to the sun
				a: 0, //angle in degree
				theSun: NaN,
				init: function(d, a, theSun){
					this.d = d;
					this.a = a;
					this.theSun = theSun;
				},
				move: function(t){
					this.a = this.a + 20 * t / 1000.0;
					if(this.a>=360)
						this.a = this.a - 360;
				},
				
				draw: function(ctx){
					ctx.save();
					ctx.translate(this.theSun.x, this.theSun.y);
					ctx.rotate(this.a * Math.PI / 180);
					ctx.fillStyle="#558def";
					ctx.beginPath();
					ctx.arc(0, -this.d, 10, 0, 2*Math.PI, true);
					ctx.fill();
					ctx.restore();
				}
			};				
			
			//the moon
			var moon = {
				d: 0, //distance to the earth
				a: 0, //angle in degree
				theSun: NaN,
				theEarth: NaN,
				init: function(d, a, theSun, theEarth){
					this.d = d;
					this.a = a;
					this.theSun = theSun;
					this.theEarth = theEarth;
				},
				move: function(t){
					this.a = this.a + 100 * t / 1000.0;
					if(this.a>=360)
						this.a = this.a - 360;
				},
				
				draw: function(ctx){
					ctx.save();
					ctx.translate(this.theSun.x, this.theSun.y);
					ctx.rotate(this.theEarth.a * Math.PI / 180);
					ctx.translate(0, -this.theEarth.d);
					ctx.rotate(this.a * Math.PI / 180);
					ctx.fillStyle="#dfe9e9";
					ctx.beginPath();
					ctx.arc(0, -this.d, 5, 0, 2*Math.PI, true);
					ctx.fill();
					ctx.restore();
				}
			};
		
			var ctx;
			var t1 = 0; //the time of the last frame
			function draw_frame(t){
			
				ctx.clearRect(0, 0, 600, 600);
				starField.draw(ctx);
				sun.draw(ctx);
				earth.draw(ctx);
				moon.draw(ctx);
			
				var elapsed = t - t1;
				t1 = t;
				
				earth.move(elapsed);
				moon.move(elapsed);
				
				requestAnimationFrame(draw_frame);
			}
		
			function start(){
				
				ctx = document.getElementById("my_canvas").getContext("2d");
				
				starField.init(600, 600);
				sun.init(300, 300);
				earth.init(200, 0, sun);
				moon. init(50, 0, sun, earth);
				
				requestAnimationFrame(draw_frame);				
				alert("hello");
			}
		</script>
	</head>
	
	<body onload="start()">
		<canvas id="my_canvas" width="600" height="600" 
		 style="border:1px solid black;"></canvas>
	</body>
</html>